#!/bin/bash
## å‚è€ƒï¼šhttps://qiita.com/MasaoSasaki/items/f10ab4cd54e228fb436f

# è‰²è¨­å®šã‚’èª­ã¿è¾¼ã‚€
source $HOME/.color_conf

# ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å®šç¾©ï¼šå¼•æ•°ã« commit-msg ã®ä¸­èº«ãŒä¸¸ã”ã¨æ¸¡ã•ã‚Œã¦ãã‚‹
MSG=$1
readonly MSG
# çµ‚äº†ã‚³ãƒ¼ãƒ‰ã‚’å®šç¾©ã€‚0: OK, 1: NG
code=0

printf "${BOLD}${WHITE}ğŸª Running Git Hooks: commit-msg${RESET}${LF}"

# Prefixã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
printf "${WHITE} - Prefixã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯: ${RESET}${LF}"
## å¿…è¦ãªPrefixã‚’å®šç¾©
readonly CORRECT_PREFIXES=("Add" "Delete" "Feature" "Fix" "Change" "Refactor" "Update" "Merge" "Initial Commit")
## å„è¦ç´ ã«": "ã‚’è¿½åŠ 
for i in "${!CORRECT_PREFIXES[@]}"; do
  correct_prefixes[i]="${CORRECT_PREFIXES[i]}: "
done

## `grep -E`ã§é…åˆ—ã‹ã‚‰ORæ¤œç´¢ã‚’ã™ã‚‹ãŸã‚ã€åŠè§’ã‚¹ãƒšãƒ¼ã‚¹(" ")ã®åŒºåˆ‡ã‚Šæ–‡å­—ã‚’ãƒ‘ã‚¤ãƒ—("|")ã«å¤‰æ›´
prefixes="$(
  IFS="|"
  echo "${correct_prefixes[*]}"
)"

if ! echo "$MSG" | grep -Eq "${prefixes}"; then
  printf  "${BOLD}${RED}NG${LF}"
  printf "================================================================${LF}"
  printf "ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«PrefixãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚${LF}"
  printf "${LF}"
  printf "Prefix${LF}"
  printf "  ${correct_prefixes[*]}${LF}"
	printf "${LF}"
	printf "1. <Type: Task Name>${LF}"
	printf "2.${LF}"
	printf "3. <Body: What you cared and how you've changed.>${LF}"
  printf "================================================================${RESET}${LF}"
  code=1
else
  printf "${BOLD}${GREEN}OK${RESET}${LF}"
fi

# çµ‚äº†å®£è¨€
if [ ${code} -eq 0 ]; then
  echo ""
  echo -e "${BOLD}${GREN}âœ¨ALL PASS!!${RESET}${LF}"
else
  echo ""
  echo -e "${BOLD}${RED}Git Hooks: commit-msg: NG${RESET}${LF}"
fi

exit ${code}
